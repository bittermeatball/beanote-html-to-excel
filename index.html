<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div>
      <h1>Chuyển từ file .html của Beanote sang Excel</h1>
      <div>
        <a
          href="https://chrome.google.com/webstore/detail/beanote-note-taking-on-we/nikccehomlnjkmgmhnieecolhgdafajb"
          target="_blank"
          rel="noopener noreferrer"
        >
          Cài extension Beanote
        </a>
      </div>
      <br />
      <div>
        <label>
          Chọn file HTML từ Beanote
          <input type="file" name="html-file" id="html-file" />
        </label>
      </div>
      <br />
      <div>
        <button id="submit-file">Chuyển sang Excel</button>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
      const fileInput = document.getElementById("html-file");
      const submitBtnEl = document.getElementById("submit-file");
      submitBtnEl.addEventListener("click", (e) => {
        const file = fileInput.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
          const contents = e.target.result;

          const contentHolderEl = document.createElement("div");
          contentHolderEl.innerHTML = contents;

          const noteItems = Array.from(contentHolderEl.childNodes)
            .filter(
              (tag) => tag.nodeName === "DIV" && tag.innerText.trim() !== "Generated by Beanote",
            )
            .map((tag) => ({
              word: tag.childNodes[0].innerText.trim(),
              translation: tag.childNodes[1].innerText.trim(),
            }));

          /* make the worksheet */
          var ws = XLSX.utils.json_to_sheet(noteItems);

          /* add to workbook */
          var wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, ws, "Translation");

          /* generate an XLSX file */
          const file = XLSX.writeFile(wb, "translation.xlsx");
          console.log(file);
        };
        reader.readAsText(file);
      });
    </script>
  </body>
</html>
